<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Webhook Service - Documentation | Smart Health Hub</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
</head>
<body class="bg-gray-50 min-h-screen">
  <div class="container mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-8">
      <div>
        <a href="/docs" class="text-blue-600 hover:underline mb-2 inline-block">‚Üê Back to Documentation</a>
        <h1 class="text-3xl font-bold text-rose-600">Webhook Service</h1>
      </div>
      <a href="/platform" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">Back to Platform Overview</a>
    </div>

    <div class="bg-white shadow-md rounded-lg p-6 mb-8">
      <h2 class="text-2xl font-semibold mb-4">Overview</h2>
      <p class="text-gray-700 mb-4">
        The Webhook Service enables real-time notifications about events occurring within the Smart Health Hub platform.
        Instead of requiring clients to poll for changes, webhooks push notifications to configured endpoints when events occur.
      </p>
      <p class="text-gray-700">
        This service is ideal for integrations that need immediate updates about patient records, claims status changes,
        or other important healthcare events.
      </p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
      <div class="lg:col-span-1">
        <div class="bg-white shadow-md rounded-lg p-6 sticky top-4">
          <h3 class="text-lg font-semibold mb-4 text-rose-600">Table of Contents</h3>
          <ul class="space-y-2">
            <li><a href="#architecture" class="text-blue-600 hover:underline">Architecture</a></li>
            <li><a href="#features" class="text-blue-600 hover:underline">Key Features</a></li>
            <li><a href="#components" class="text-blue-600 hover:underline">Major Components</a></li>
            <li><a href="#security" class="text-blue-600 hover:underline">Security</a></li>
            <li><a href="#event-types" class="text-blue-600 hover:underline">Event Types</a></li>
            <li><a href="#examples" class="text-blue-600 hover:underline">Code Examples</a></li>
            <li><a href="#best-practices" class="text-blue-600 hover:underline">Best Practices</a></li>
          </ul>
        </div>
      </div>

      <div class="lg:col-span-3">
        <div id="architecture" class="bg-white shadow-md rounded-lg p-6 mb-8">
          <h3 class="text-2xl font-semibold mb-4">Architecture</h3>
          <p class="text-gray-700 mb-4">
            The Webhook Service is built on a microservices architecture with the following components:
          </p>
          <div class="mb-4 bg-gray-100 p-4 text-center">
            <p class="text-gray-700">[Webhook Service Architecture Diagram]</p>
          </div>
          <p class="text-gray-700">
            Webhooks are delivered through an event-driven architecture using a message queue system to ensure reliable delivery.
            The service handles retries, backoff strategies, and delivery tracking to provide maximum reliability.
          </p>
        </div>

        <div id="features" class="bg-white shadow-md rounded-lg p-6 mb-8">
          <h3 class="text-2xl font-semibold mb-4">Key Features</h3>
          <ul class="list-disc ml-6 space-y-2 text-gray-700">
            <li><strong>Subscription Management:</strong> Create, read, update, and delete webhook subscriptions</li>
            <li><strong>HMAC Signature Verification:</strong> Cryptographically secure webhook payloads</li>
            <li><strong>Automatic Retries:</strong> Configurable retry attempts for failed deliveries</li>
            <li><strong>Event Filtering:</strong> Subscribe only to specific events and entities</li>
            <li><strong>Delivery Tracking:</strong> Monitor successful and failed webhook deliveries</li>
            <li><strong>SDK Support:</strong> Client libraries for multiple languages</li>
          </ul>
        </div>

        <div id="components" class="bg-white shadow-md rounded-lg p-6 mb-8">
          <h3 class="text-2xl font-semibold mb-4">Major Components</h3>
          <div class="space-y-4">
            <div>
              <h4 class="text-lg font-medium text-rose-600">Subscription Manager</h4>
              <p class="text-gray-700">Handles the creation and management of webhook subscriptions, storing configuration data in the database.</p>
            </div>
            <div>
              <h4 class="text-lg font-medium text-rose-600">Event Publisher</h4>
              <p class="text-gray-700">Captures events from throughout the platform and determines which subscriptions should receive notifications.</p>
            </div>
            <div>
              <h4 class="text-lg font-medium text-rose-600">Delivery Service</h4>
              <p class="text-gray-700">Sends HTTP requests to subscriber endpoints, handles retries, and tracks delivery status.</p>
            </div>
            <div>
              <h4 class="text-lg font-medium text-rose-600">Security Module</h4>
              <p class="text-gray-700">Signs webhook payloads with HMAC signatures to ensure authenticity and integrity.</p>
            </div>
          </div>
        </div>

        <div id="security" class="bg-white shadow-md rounded-lg p-6 mb-8">
          <h3 class="text-2xl font-semibold mb-4">Security</h3>
          <p class="text-gray-700 mb-4">
            The Webhook Service implements several security measures to protect webhook data:
          </p>
          <ul class="list-disc ml-6 space-y-2 text-gray-700">
            <li><strong>HMAC-SHA256 Signatures:</strong> Each webhook request includes a signature header generated using the webhook secret</li>
            <li><strong>Timestamp Validation:</strong> Webhook requests include a timestamp to prevent replay attacks</li>
            <li><strong>HTTPS Only:</strong> All webhook deliveries are made over HTTPS</li>
            <li><strong>Secure Secrets Storage:</strong> Webhook secrets are stored securely using encryption at rest</li>
            <li><strong>Access Control:</strong> Only authorized users can create, view, update, or delete webhook subscriptions</li>
          </ul>
        </div>

        <div id="event-types" class="bg-white shadow-md rounded-lg p-6 mb-8">
          <h3 class="text-2xl font-semibold mb-4">Event Types</h3>
          <p class="text-gray-700 mb-4">
            The Webhook Service supports a wide range of event types:
          </p>
          <div class="overflow-x-auto">
            <table class="min-w-full border-collapse">
              <thead>
                <tr class="bg-gray-100">
                  <th class="px-4 py-2 text-left border border-gray-300">Event Type</th>
                  <th class="px-4 py-2 text-left border border-gray-300">Description</th>
                  <th class="px-4 py-2 text-left border border-gray-300">Example Payload</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="px-4 py-2 border border-gray-300"><code>patient.created</code></td>
                  <td class="px-4 py-2 border border-gray-300">A new patient record is created</td>
                  <td class="px-4 py-2 border border-gray-300"><a href="#" class="text-blue-600 hover:underline">View Example</a></td>
                </tr>
                <tr>
                  <td class="px-4 py-2 border border-gray-300"><code>patient.updated</code></td>
                  <td class="px-4 py-2 border border-gray-300">A patient record is updated</td>
                  <td class="px-4 py-2 border border-gray-300"><a href="#" class="text-blue-600 hover:underline">View Example</a></td>
                </tr>
                <tr>
                  <td class="px-4 py-2 border border-gray-300"><code>claim.status_changed</code></td>
                  <td class="px-4 py-2 border border-gray-300">A claim's status changes</td>
                  <td class="px-4 py-2 border border-gray-300"><a href="#" class="text-blue-600 hover:underline">View Example</a></td>
                </tr>
                <tr>
                  <td class="px-4 py-2 border border-gray-300"><code>encounter.completed</code></td>
                  <td class="px-4 py-2 border border-gray-300">An encounter is completed</td>
                  <td class="px-4 py-2 border border-gray-300"><a href="#" class="text-blue-600 hover:underline">View Example</a></td>
                </tr>
                <tr>
                  <td class="px-4 py-2 border border-gray-300" colspan="3">
                    <a href="/api-docs/webhook-service/event-types" class="text-blue-600 hover:underline">View all event types</a>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div id="examples" class="bg-white shadow-md rounded-lg p-6 mb-8">
          <h3 class="text-2xl font-semibold mb-4">Code Examples</h3>
          <div class="space-y-6">
            <div>
              <h4 class="text-lg font-medium text-rose-600 mb-2">Create a Webhook Subscription</h4>
              <pre><code class="language-javascript">const { WebhookClient } = require('smarthealthhub-webhook-client');

const client = new WebhookClient({
  apiKey: 'your-api-key',
  baseUrl: 'https://api.smarthealthhub.com'
});

async function createSubscription() {
  const subscription = await client.createSubscription({
    name: 'Patient Updates',
    endpointUrl: 'https://my-app.example.com/webhooks',
    events: [
      'patient.created',
      'patient.updated'
    ],
    securityScheme: 'hmac',
    maxRetries: 5
  });
  
  console.log('Created subscription:', subscription);
}</code></pre>
            </div>

            <div>
              <h4 class="text-lg font-medium text-rose-600 mb-2">Verify a Webhook Signature</h4>
              <pre><code class="language-javascript">// In your Express route handler
app.post('/webhooks', (req, res) => {
  const isValid = client.verifyWebhookSignature(req.headers, req.rawBody);
  
  if (isValid) {
    // Process the webhook
    console.log('Received event:', req.body.eventName);
    res.status(200).send('OK');
  } else {
    res.status(400).send('Invalid signature');
  }
});</code></pre>
            </div>
          </div>
        </div>

        <div id="best-practices" class="bg-white shadow-md rounded-lg p-6">
          <h3 class="text-2xl font-semibold mb-4">Best Practices</h3>
          <ul class="list-disc ml-6 space-y-2 text-gray-700">
            <li><strong>Always verify signatures:</strong> Never trust webhooks without verifying their signatures</li>
            <li><strong>Respond quickly:</strong> Your webhook endpoint should return a 2xx status code as quickly as possible</li>
            <li><strong>Process asynchronously:</strong> Handle the actual webhook processing outside the request-response cycle</li>
            <li><strong>Implement idempotency:</strong> Process webhooks exactly once, even if you receive duplicates</li>
            <li><strong>Monitor deliveries:</strong> Regularly check the delivery status of your webhooks</li>
            <li><strong>Use event filtering:</strong> Subscribe only to the events you actually need</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</body>
</html>